---
nav_title: セグメントの作成
article_title: セグメントの作成
page_order: 1
page_type: tutorial
description: "この記事では、Braze を使用してセグメントを設定・作成する手順について説明します。"
tool: Segments
search_rank: 3
---

# [![Brazeラーニングコース]({% image_buster /assets/img/bl_icon3.png %})](https://learning.braze.com/segmentation-course){: style="float:right;width:120px;border:0;" class="noimgborder"}Segmentの作成

> セグメンテーションにより、人口統計、行動、または技術的な特徴やアクションに基づいてユーザーをターゲットすることができます。セグメンテーションとメッセージングの自動化を創造的かつインテリジェントに使用することで、ユーザーをファーストタッチから長期顧客へとシームレスに移行できます。セグメントは、データの変更に応じてリアルタイムで更新されます。また、ターゲットおよびメッセージングの目的で必要な数のセグメントを作成できます。

## ステップ 1:セグメントセクションに移動する

\[**オーディエンス**] > \[**セグメント**] に移動します。

{% alert note %}
[古いナビゲーションを使用している場合は]({{site.baseurl}}/navigation)、\[**エンゲージメント**] に \[**セグメント**] が表示されます。
{% endalert %}

## ステップ2:セグメントに名前を付ける

**Create Segment**を選択して、セグメントの作成を開始します。セグメントに名前を付けます。絞り込むユーザーのタイプがわかるような名前にしてください。これは、キャンペーンやキャンバスでセグメントを特定するのに役立つ。曖昧なセグメント名は混乱を招く。

オプションとして、以下のことができる：
- セグメントに説明を追加して、この視聴者の意図について詳しく説明し、他のチームメンバーが参照できるようにメモを残す。
- [チームを]({{site.baseurl}}/user_guide/administrative/app_settings/manage_your_braze_users/teams/)セグメントに加える。
- さらに整理するために、セグメントに[タグを]({{site.baseurl}}/user_guide/administrative/app_settings/tags/)追加する。

![セグメント名を "Lapsed Users "とし、セグメント説明を "This is our main Lapsed User segment to target non-actives within past 14 days "として、2つのボタンを持つセグメントモーダルを作成する：キャンセルしてセグメントを作成する。][2]{: style="max-width:70%;"}

## ステップ 3:アプリまたはプラットフォームを選択する

\[**すべてのアプリのユーザー**] (デフォルト) または \[**特定のアプリのユーザー**] を選択して、ターゲットにするアプリまたはプラットフォームを選択します。\[**すべてのアプリのユーザー**] を選択すると、セッションやアプリデータに関係なく、セグメントにはすべてのユーザーが含まれます。\[**特定のアプリのユーザー**] を選択すると、セグメントに含めるアプリまたはプラットフォームを選択できます。

例えば、アプリ内メッセージを iOS デバイスのみに送信したい場合は、iOS アプリを選択します。これにより、iOS デバイスと Android デバイスの両方を使用するユーザーは、iOS デバイスのみでメッセージを受信します。特定のアプリのリストで、\[**どのアプリも使用していないユーザー**] オプションを選択すると、セッションもアプリデータもないユーザーを含められます (通常はユーザーインポートまたは REST API で作成)。

![セグメント詳細パネルで、「使用アプリ」セクションで「すべてのアプリからのユーザー」オプションを選択した状態。][5]{: style="max-width:70%;"}

## ステップ 4:セグメントにフィルターを追加する

セグメントに少なくとも1つのフィルターを追加する。好きなだけフィルターを組み合わせて、セグメンテーションをより具体的にすることができる。

{% alert note %}
Braze は、アプリを初めて使用するまでユーザーのプロファイルを生成しないため、アプリをまだ開いていないユーザーをターゲットにすることはできません。
{% endalert %}

#### フィルター・グループ

フィルターはフィルター・グループにまとめられている。すべてのフィルターは、最低1つのフィルターを持つフィルターグループの一部でなければならない。セグメントは複数のフィルターグループを持つことができる。追加するには、**Add filter groupを**選択する。フィルターグループ名の横にカーソルを置くと表示されるアイコンを選択して、フィルターグループ名を編集する。

![フィルタグループの名前の横に編集アイコンがある。][14]{: style="max-width:70%;"}

各フィルタの横にあるアイコンを選択すると、フィルタエディタを折りたたんだり、フィルタを複製したり、フィルタを削除したりできる。フィルターを複製した後、各ドロップダウン内でその値を調整することができる。

各フィルターグループ内のアイコンを使って、そのフィルターグループとその中のフィルターを複製したり、セグメントからそのフィルターグループを削除することもできる。

#### ANDとORを使ったセグメンテーション・ロジック

フィルターグループ内では、フィルターは "AND "か "OR "で結合できる。フィルター・グループ間では、グループは "AND "か "OR "で結合できる。フィルターグループを使うと、次のようなセグメンテーション・ロジックを作ることができる：
- (AとBとC)または(CとEとF)
- (AまたはBまたはC)と(CまたはDまたはF)

フィルターに "OR "を選択すると、セグメントには、これらのフィルターの1つ、いくつか、またはすべての組み合わせを満たすユーザーが含まれることになる。AND」を選択すると、そのフィルターを通らなかったユーザーはセグメントに含まれない。

{% alert tip %}
否定的なフィルター（購読グループに "いない "など）を含むフィルターのために "OR "を選択するとき、ユーザーはセグメントに含まれるために "OR "フィルターの1つを満たすだけでよいことを覚えておいてほしい。他のフィルターに関係なくネガティブフィルターを適用するには、[除外グループを](#exclusion)使う。
{% endalert %}

#### フィルター演算子

選択したフィルターによって、フィルター値を特定するための演算子は異なる。さまざまなタイプのカスタム属性で利用可能な演算子について詳しく知りたい場合は、[カスタム属性ストレージを]({{site.baseurl}}/user_guide/data_and_analytics/custom_data/custom_attributes/#setting-custom-attributes)参照のこと。is any of」演算子を使う場合、そのフィールドに含めることができる項目の最大数は256であることに注意。

{% alert note %}
Braze は、アプリを初めて使用するまでユーザーのプロファイルを生成しないため、アプリをまだ開いていないユーザーをターゲットにすることはできません。
{% endalert %}

![セグメンターはAND演算子でグループをフィルターする。][9]{: style="max-width:70%;"}

{% alert important %}
すでに**セグメント・メンバーシップ・フィルターを**使用しているセグメントを、さらに他のセグメントに含めたり、入れ子にしたりすることはできない。
{% endalert %}

#### 除外グループ（オプション） {#exclusion}

セグメントを構築する際、1つまたは複数の除外グループを適用できる。除外グループには、セグメントから除外するユーザーを特定する基準が含まれ、常に "AND NOT "演算子でフィルタグループに接続される。

除外グループはセグメント基準を上書きする。ユーザーが除外グループ基準に該当する場合、フィルターグループ内の基準を満たしていても、セグメントには含まれない。

フィルターグループと同じようにフィルターを追加して除外グループを作成する。除外グループの_推定到達可能ユーザー_数統計は、除外基準適用後にセグメントに残る推定ユーザー数を示す。

除外されたユーザーは、セグメントの_合計到達可能ユーザー_統計の一部としてカウントされない。

![2つのフィルターを持つ除外グループ。][12]{: style="max-width:70%;"}

#### セグメントのテスト

セグメントにアプリとフィルターを追加したら、ユーザーを検索してセグメント条件と一致するかどうかを確認することで、セグメントが期待どおりに設定されているかどうかをテストできます。そのためには、**User Lookup**セクションでユーザーの`external_id` または`braze_id` を検索する。

![検索フィールドを備えたユーザー検索セクション。][6]{: style="max-width:80%;"}

ユーザールックアップ検索は次の場合に利用できます。
- セグメントを作成する
- キャンペーンまたはキャンバス・オーディエンスを設定する
- オーディエンス・パスのステップを設定する

ユーザーがセグメント、フィルター、アプリの条件にマッチすると、アラートにその旨が表示される。

![user007 "のユーザー検索は、"user007はすべてのセグメント、フィルタ、およびアプリに一致する "というアラートをトリガーする。][7]{: style=" max-width:80%;"}

ユーザーがセグメント、フィルター、またはアプリの条件の一部またはすべてに一致しない場合、トラブルシューティングのために欠落している条件がリストされます。

![user1234 "のユーザールックアップは、"user1234 does not match following targeting criteria:（user1234は以下のターゲット条件にマッチしません）"というアラートをトリガーし、2つの欠けている条件を表示する。][8]{: style=" max-width:80%;"}

#### シングルユーザーセグメント

ユーザー名やユーザーID などのユーザーを識別する一意の属性を使用して、単一のユーザーセグメント (または少数のユーザーのセグメント) を作成できます。

ただし、セグメント統計は、結果が +/-1% 以内という 95% の信頼区間のランダムサンプルに基づいて計算されるため、セグメンテーション統計またはプレビューにはこの個々のユーザーが表示されない場合があります。ユーザーベースが大きいほど、セグメントのサイズは概算である可能性が高くなります。セグメントにターゲットとするユーザーが含まれていることを確認するには、「**正確な統計情報を計算する**」を選択する。これにより、セグメント内の正確なユーザー数が 99.999% を超える精度で計算されます。

Braze には、ユーザー ID またはメールアドレスで特定のユーザーをターゲットにするテストフィルターがあります。

### ステップ 5: セグメントを保存する

**保存を**選択する。これで、ユーザーへのメッセージ送信を開始する準備が整った！

## セグメントメンバーシップの計算 {#segment-membership-calculation}

Braze は、データが当社のサーバーに送り返されて処理されると、通常はユーザーのセグメントメンバーシップを瞬時に更新します。ユーザーのセグメントメンバーシップは、そのセッションが処理されるまで変更されません。例えば、セッションが最初に開始されたときに失効したユーザーセグメントに入ったユーザーは、セッションが処理されるとすぐに離脱ユーザーセグメントから移動されます。

### リーチ可能なユーザーの合計の計算

各セグメントには、そのセグメントのメンバーであるユーザーの総数が表示されます。**すべてのアプリのユーザー**をフィルターすると、ウェブプッシュやメールなど、それらのユーザーと通信できるさまざまなチャネルもすべて表示されます。ユーザーの合計数は、各チャネルでリーチ可能なユーザー数と異なる場合があります。

![電子メール、iOSプッシュ、Androidプッシュ、ウェブプッシュ、Kindleプッシュ、Androidチャイナプッシュで到達可能なユーザー別に、到達可能な総ユーザーを表示した表。][10]

ユーザーが特定のチャネルを通じてリーチ可能と表示されるには、次の両方が必要です: 
* プロフィールに関連付けられた有効な電子メールアドレスまたはプッシュトークン。
* あなたのアプリに登録した。

1 人のユーザーが異なるリーチ可能なユーザーグループに属している場合があります。例えば、ユーザーが有効なメールアドレスと有効な Android プッシュトークンの両方を持っていて、両方にオプトインしている一方、iOS プッシュトークンは関連付けられていない場合があります。リーチ可能なユーザーの総数と、異なるチャネルの合計との差は、セグメントの対象でありながら、それらの通信チャネルではリーチできないユーザーの数です。

### セグメント・サイズの統計

Brazeはセグメントサイズについて次のような統計を行っている。すべての推定統計値は、実際の値の上下1％以内であり、正確なセグメントメンバーシップは、キャンペーンまたはキャンバスで送信されたメッセージによってセグメントが影響を受ける前に、常に計算される。

#### フィルター統計

フィルターグループごとに、推定到達可能ユーザーを見ることができる。チャンネル間の内訳を見るには、**Expand extra funnel statisticsを**選択する。

![性別が不明でないフィルターグループ。][4]{: style="max-width:80%;"}

#### セグメント統計

セグメント全体について、到達可能な推定ユーザー数、および各チャネルの推定ユーザー数をページ下部で見ることができる。また、「**正確な統計情報を計算する**」を選択することで、到達可能なユーザーの正確な数（セグメント全体とチャネルごとの両方）を表示することもできる。

注意してほしい：
- 正確な統計の計算には数分かかる。この関数は、フィルターやフィルターグループレベルではなく、セグメントレベルでの正確な統計を計算するだけである。
- 大きなセグメントでは、正確な統計を計算しても、通常はわずかな変動が見られます。この機能の精度は、99.999% 以上であることが期待されます。

## セグメントのアーカイブ

特定のセグメントが不要になったり、引退したくなった場合は、**セグメント**ページに行き、そのセグメントの行にあるメニューから**アーカイブを**選択することで、そのセグメントをアーカイブすることができる。

{% alert warning %}
セグメントをアーカイブすると、そのセグメントを使用しているキャンペーンやキャンバスもアーカイブされます (セグメントが単一のキャンバスコンポーネントでのみ使用されている場合も含む)。これには、両方のセグメントと、それらを使用するキャンペーンやキャンバスをネストしたセグメントもアーカイブに含まれます。
<br><br>
関連するセグメントをアーカイブすると、どのキャンペーンとキャンバスがアーカイブされるかが警告リストに表示されます。
{% endalert %}

セグメントのアーカイブを解除するには、\[**セグメント**] ページ内でセグメントに移動し、\[**アーカイブ解除**] を選択します。

## ユーザーが複数のデバイスを持っている場合のターゲティング行動

複数のデバイスで同じアカウントにログインしている場合、ユーザーは複数のデバイスを持っている。[ユーザー・プロフィールの]({{site.baseurl}}/user_guide/engagement_tools/segments/user_profiles/)「**最近使ったデバイス**」セクションで、複数のデバイスをチェックできる。

デバイス依存のフィルター（デバイスモデル、デバイスOS、アプリのバージョン）を使ってセグメント化する場合、セグメントにはフィルター基準に一致するすべてのユーザーが含まれる。これらのユーザーには、フィルター基準を満たさないものも含め、すべてのデバイスにメッセージが送信される。例えば、ユーザーAが2台のデバイスを持っているとしよう：デバイス1はOS 13.0、デバイス2はOS 10.0だ。あるセグメントがOS 10.0のユーザーをターゲットにしている場合、このユーザーはそのセグメントの一部となり、両方のデバイスでメッセージを受け取ることになる。

### プッシュ通知

各ユーザーに1回だけプッシュ通知を送るように指定できる。[メッセージを作成する]({{ssite.baseurl}}/user_guide/message_building_by_channel/push/creating_a_push_message#step-4-compose-your-push-message)際、「**追加設定**」で「**ユーザーの最後に使用したデバイスにのみ送信する**」を選択する。

![][13]{: style="max-width:60%;"}

### 考慮事項

- **送信されたメッセージは視聴者数を超えることがある。**複数のデバイスを持つユーザーがいる場合、それぞれのデバイスがメッセージを受信することができる。そのため、セグメント内のユーザーよりもメッセージ送信数が多くなる。
- **ユーザーのセグメントメンバーシップは、あなたが期待するようなものではないかもしれない。**
    - ユーザーは、別のデバイスに関連する属性に基づいて、現在のデバイスをターゲットにすることができる。ユーザーがメッセージを受信することを予期していなかった場合、そのユーザーのユーザー・プロフィールに複数のデバイスがないか確認する。
    - あるユーザーは、送信時にはターゲット・セグメントに入っていたかもしれないが、その後、そのユーザーのデバイスに関連する行動によって、ターゲット・セグメントに含まれなくなる可能性がある。その結果、現在フィルター条件にマッチしていないにもかかわらず、ユーザーがキャンペーンやキャンバスを受け取ってしまう可能性がある。<br><br>例えば、現在OS 13.0を使っているにもかかわらず、最新アプリのバージョンがOS 10.0のユーザーをターゲットにしたメッセージを受け取る可能性がある。このケースでは、メッセージ送信時にOS10.0を使用しており、その後OS13.0にアップグレードした。<br><br> 同様に、ユーザーが後に異なるアプリバージョンのデバイスを使用した場合、ユーザープロファイルは新しい最新アプリバージョンで更新される。これでは、メッセージが送信されたときには適格であったにもかかわらず、ユーザーはそのメッセージを受け取る資格がなかったと思われるかもしれない。


[1]: {% image_buster /assets/img_archive/Segment1.png %}
[2]: {% image_buster /assets/img_archive/Segment2.png %}
[3]: {% image_buster /assets/img_archive/segment_step4.png %}
[4]: {% image_buster /assets/img_archive/segment_filter_stats.png %}
[5]: {% image_buster /assets/img_archive/segment_app_selection.png %}
[6]: {% image_buster /assets/img_archive/user_lookup.png %}
[7]: {% image_buster /assets/img_archive/user_lookup_match.png %}
[8]: {% image_buster /assets/img_archive/user_lookup_nomatch.png %}
[9]: {% image_buster /assets/img_archive/segmenter_filter_groups.png %}
[10]: {% image_buster /assets/img_archive/segmenter_reachable_users.png %}
[11]: {% image_buster /assets/img_archive/segmenter_and_or.png %}
[12]: {% image_buster /assets/img_archive/segmenter_exclusion_groups.png %}
[13]: {% image_buster /assets/img_archive/send_to_last_device.png %}
[14]: {% image_buster /assets/img_archive/edit_filter_group_name.png %}