---
nav_title: 在庫復活通知
article_title: 在庫復活通知
page_order: 2
description: "このリファレンス記事では、Brazeカタログで再入荷通知を作成する方法について説明します。"
---

# 在庫復活通知

> Brazeカタログとキャンバスを組み合わせた再入荷通知を使用して、商品が再入荷した際に顧客に通知することができます。顧客が選択したカスタムイベントを実行するたびに、アイテムが補充されたときに通知されるように自動的に購読されます。

{% alert important %}
カタログの在庫復活通知は現在早期アクセス中です。早期アクセスに参加したい場合は、アカウントマネージャーに連絡してください。
{% endalert %}

ユーザーがアイテムのカスタムイベントをトリガーすると、そのアイテムの再入荷通知を自動的に受け取るように登録されます。商品の在庫数量が在庫ルール（100以上の在庫など）を満たすと、すべての購読者がキャンペーンまたはキャンバスを通じて通知を受ける資格があります。ただし、通知を選択したユーザーのみが通知を受け取ります。 

## 在庫復活通知の仕組み

カスタムイベントをサブスクリプションイベントとして使用するために設定します。例えば、`product_clicked`イベントなどです。このイベントには、アイテムID（カタログアイテムID）のプロパティが含まれている必要があります。カタログ名を含めることをお勧めしますが、これは必須ではありません。また、インベントリ数量フィールドの名前を指定する必要があります。これは数値データ型でなければなりません。

アイテムの在庫数量が在庫ルールを満たしている場合、そのアイテムにサブスクライブしているすべてのユーザー（サブスクリプションイベントを行ったユーザー）を検索し、キャンペーンやキャンバスをトリガーするために使用できるBrazeカスタムイベントを送信します。

イベントプロパティはユーザーと一緒に送信されるため、アイテムの詳細をキャンペーンやキャンバスにテンプレートできます！

## 在庫復活通知の設定

特定のカタログで再入荷通知を設定する手順に従ってください。

1. カタログに移動して、**設定**タブを選択します。
2. **在庫が戻った**トグルを選択します。
3. グローバルな再入荷設定が構成されていない場合、再入荷通知を{トリガー}するために使用されるカスタムイベントとプロパティを設定するように求められます:
    <br> ![カタログ設定ドロワー。][2]{: style="max-width:70%;"}
    - **サブスクリプションのカスタムイベント**は、在庫復活通知のためにユーザーをサブスクライブするために使用されるBrazeのカスタムイベントです。このイベントが発生すると、イベントを実行したユーザーが購読されます。
    - **配信停止のためのカスタムイベント**は、在庫復活通知の配信を停止するために使用されるBrazeのカスタムイベントです。
    - **アイテムIDイベントプロパティ**は、在庫復帰サブスクリプションまたはサブスクリプション解除のためのアイテムを決定するために使用される上記のカスタムイベントのプロパティです。このプロパティはカスタムイベントに含まれているアイテムIDを含む必要があり、それはカタログに存在します。カスタムイベントには、このアイテムがどのカタログにあるかを指定するための`catalog_name`プロパティも含める必要があります。
    - **フォールバックカタログ** これは、カスタムイベントに`catalog_name`プロパティが存在しない場合に、在庫復活サブスクリプションに使用されるカタログです。
    - サンプルのカスタムイベントは次のようになります
    ```json
    {
        "events": [
            {
                "external_id": "<external_id>",
                "name": "subscription",
                "time": "2024-04-15T19:22:28Z",
                "properties": {
                    "id": "shirt-xl",
                    "catalog_name": "on_sale_products",
                    "type": ["back_in_stock"]
                }
            }
        ]
    }
    ```

4. **保存**を選択し、カタログの在庫復活設定ページに進みます。
5. 通知ルールを設定します。選択肢は2つあります:
    - **すべての購読者に通知する**は、商品が再入荷したときに待っているすべての顧客に通知します。 
    - **一定数のユーザーに一定数の分ごとに通知する**は、設定された通知期間ごとに指定された数の顧客に通知します。Brazeは、通知する顧客がいなくなるか、アイテムが在庫切れになるまで、指定された数の顧客に段階的に通知します。通知レートは、1分あたり10,000人のユーザーに通知することを超えることはできません。
6. カタログの**インベントリフィールド**を設定します。このカタログフィールドは、アイテムが在庫切れかどうかを判断するために使用されます。フィールドは数値型である必要があります。
7. **設定を保存**を選択します。

![カタログ設定で、再入荷機能がオンになっていることを示します。通知ルールは、10分ごとに1000人のユーザーに通知することです。][1]

{% alert important %}
これらの設定の通知ルールは、キャンバスの通知設定（クワイエットアワーなど）を置き換えるものではありません。
{% endalert %}

## キャンバスで再入荷通知を使用する

カタログで再入荷機能を設定した後、キャンバスで使用するために次の手順に従ってください。

1. アクションベースのキャンバスを設定します。
2. **在庫あり**をトリガーとして選択します。
3. 在庫が戻った通知があるカタログの名前を選択します。
4. キャンバスを通常通り[設定]({{site.baseurl}}/user_guide/engagement_tools/canvas/create_a_canvas/create_a_canvas/)し続けてください。

今、商品が再入荷した際にお客様に通知することができます。

### Liquidを使用する

再入荷したカタログアイテムの詳細をテンプレート化するには、 `canvas_entry_properties` Liquid タグでアクセス `item_id`。 

{%raw%}``{{canvas_entry_properties.${catalog_update}.item_id}}``{%endraw%}を使用すると、在庫が戻ったアイテムのIDが返されます。{%raw%}``{{canvas_entry_properties.${catalog_update}.previous_value}}``{%endraw%}は、更新前のアイテムの在庫価値を返し、{%raw%}``{{canvas_entry_properties.${catalog_update}.new_value}}``{%endraw%}は、更新後の新しい在庫価値を返します。

このLiquidタグ{%raw%}``{% catalog_items <name_of_your_catalog> {{canvas_entry_properties.${catalog_update}.item_id}} %}}``{%endraw%}をメッセージの先頭に使用し、その後メッセージ全体でそのアイテムに関するデータにアクセスするために{%raw%}``{{ items[0].<field_name> }}``{%endraw%}を使用します。

## 考慮事項

- ユーザーは90日間のみ購読されます。アイテムが90日以内に在庫に戻らない場合、ユーザーは購読を解除されます。
- **通知すべての購読者** 通知ルールを使用する場合、Brazeは10分間で100,000人に通知します。
- Brazeは1分間に最大10件のアイテム更新を処理します。1分間に11個のアイテムを更新した場合、最初の10個のみが再入荷通知をトリガーできます。

[1]: {% image_buster /assets/img/back_in_stock_settings.png %}
[2]: {% image_buster /assets/img/catalog_settings_drawer.png %}
